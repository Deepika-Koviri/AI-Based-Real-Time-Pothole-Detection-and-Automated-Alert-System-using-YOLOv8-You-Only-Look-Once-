{% extends "base.html" %}
{% block content %}

<style>
  :root {
    --bg-main: #d6e6f2;
    --bg-card: #ffffff;
    --accent: #6eb8e1;
    --accent-soft: #c8abe6;
    --text-main: #1f2933;
    --text-muted: #6b7280;
    --border-subtle: #e5e7eb;
  }

  body {
    background: linear-gradient(135deg, #d6e6f2 0%, #ffffff 45%, #c8abe6 100%);
  }

  .dash-main {
    display: grid;
    grid-template-columns: 0.95fr 1.05fr;
    gap: 1.6rem;
  }

  .dash-card {
    background: var(--bg-card);
    border-radius: 24px;
    padding: 1.6rem 1.7rem 1.8rem;
    box-shadow:
      0 18px 45px rgba(148, 163, 184, 0.35),
      0 0 0 1px rgba(148, 163, 184, 0.3);
  }

  .dash-header {
    background: var(--bg-card);
    border-radius: 24px;
    padding: 1.3rem 1.7rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.4rem;
    box-shadow:
      0 16px 40px rgba(148, 163, 184, 0.35),
      0 0 0 1px rgba(148, 163, 184, 0.3);
  }

  .dash-title h1 {
    margin: 0;
    font-size: 1.7rem;
    color: var(--text-main);
  }

  .dash-title p {
    margin: 0.2rem 0 0;
    font-size: 0.85rem;
    color: var(--text-muted);
  }

  .dash-badge {
    padding: 0.3rem 0.8rem;
    border-radius: 999px;
    background: rgba(110, 184, 225, 0.16);
    color: #1d4ed8;
    font-size: 0.78rem;
    margin-right: 0.4rem;
  }

  .btn {
    padding: 0.55rem 1.15rem;
    border-radius: 999px;
    border: none;
    cursor: pointer;
    font-weight: 500;
    font-size: 0.9rem;
    white-space: nowrap;
  }
  .btn-primary {
    background: linear-gradient(90deg, var(--accent), var(--accent-soft));
    color: #ffffff;
  }
  .btn-outline {
    background: transparent;
    border: 1px solid #d1d5db;
    color: #111827;
  }
  .btn-full { width: 100%; }

  .section-label {
    font-size: 0.78rem;
    text-transform: uppercase;
    letter-spacing: 0.09em;
    color: var(--text-muted);
    margin-bottom: 0.45rem;
  }

  .card-title {
    font-size: 1.05rem;
    font-weight: 600;
    color: var(--text-main);
    margin: 0 0 0.6rem;
  }

  label {
    display: block;
    font-size: 0.8rem;
    margin-bottom: 0.25rem;
    color: var(--text-muted);
  }

  input {
    width: 100%;
    border-radius: 12px;
    border: 1px solid var(--border-subtle);
    padding: 0.5rem 0.7rem;
    background: #f9fafb;
    color: var(--text-main);
    font-size: 0.9rem;
  }

  input:focus {
    outline: none;
    border-color: var(--accent);
    background: #ffffff;
    box-shadow: 0 0 0 1px rgba(110, 184, 225, 0.5);
  }

  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.9rem;
    margin-top: 0.3rem;
  }

  .grid-3 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.9rem;
    margin-top: 0.4rem;
  }

  .checkbox-row {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    margin-top: 1.6rem;
    font-size: 0.8rem;
    color: var(--text-muted);
  }

  .result-img {
    width: 100%;
    border-radius: 16px;
    margin-top: 0.7rem;
    border: 1px solid var(--border-subtle);
  }

  .result-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.8rem;
    margin-top: 0.9rem;
  }

  .result-table th,
  .result-table td {
    padding: 0.35rem 0.45rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .result-table th {
    text-align: left;
    color: var(--text-muted);
    font-weight: 500;
  }

  .pill-severity {
    padding: 0.15rem 0.6rem;
    border-radius: 999px;
    font-size: 0.75rem;
  }
  .pill-severity.Large { background:#fee2e2; color:#b91c1c; }
  .pill-severity.Medium { background:#fef3c7; color:#92400e; }
  .pill-severity.Small { background:#dcfce7; color:#166534; }

  @media (max-width: 1000px) {
    .dash-main { grid-template-columns: 1fr; }
  }
</style>

<header class="dash-header">
  <div class="dash-title">
    <h1>AI-Based Pothole Detection System</h1>
    <p>Real-time road safety &amp; smart monitoring · Welcome, {{ user_name }}.</p>
  </div>
  <div style="display:flex; align-items:center; gap:0.7rem;">
    <span class="dash-badge">Vision · YOLOv8 · MiDaS</span>
    <a href="{{ url_for('pothole_map') }}" class="btn btn-outline">View map</a>
    <a href="{{ url_for('logout') }}" class="btn btn-outline">Logout</a>
  </div>
</header>

<main class="dash-main">
  <!-- LEFT: upload & controls (no location textbox) -->
  <section class="dash-card">
    <div class="section-label">Upload road image</div>
    <h2 class="card-title">Input &amp; cost settings</h2>

    <form method="POST" enctype="multipart/form-data">
      <label>Road image</label>
      <input type="file" name="image" accept="image/*" required />

      <div class="section-label" style="margin-top:1.1rem;">Cost configuration (India)</div>
      <div class="grid-2">
        <div>
          <label>Min rate (₹ per m³)</label>
          <input type="number" name="rate_min" value="4000" min="1000" max="20000" step="500" />
        </div>
        <div>
          <label>Max rate (₹ per m³)</label>
          <input type="number" name="rate_max" value="6000" min="1000" max="30000" step="500" />
        </div>
      </div>

      <div class="grid-3">
        <div>
          <label>Max pothole depth (cm)</label>
          <input type="number" name="max_depth_cm" value="10" min="5" max="30" />
        </div>
        <div>
          <label>Approx. ground scale (cm / pixel)</label>
          <input type="number" name="pixel_to_cm" value="0.5" step="0.1" />
        </div>
        <div class="checkbox-row">
          <input type="checkbox" name="alerts_enabled" id="alerts" checked />
          <label for="alerts" style="margin:0;">Enable alerts</label>
        </div>
      </div>

      <button type="submit" class="btn btn-primary btn-full" style="margin-top:1rem;">
        Detect potholes
      </button>
    </form>
  </section>

  <!-- RIGHT: detections -->
  <section class="dash-card">
    <div class="section-label">Detections</div>
    <h2 class="card-title">Pothole analytics</h2>

    {% if annotated_image %}
      <img src="/{{ annotated_image }}" alt="Pothole detections" class="result-img" />
    {% else %}
      <p style="font-size:0.85rem; color:var(--text-muted); margin-top:0.4rem;">
        Upload a road image to visualize detected potholes, severity, and repair estimates.
      </p>
    {% endif %}

    {% if detections %}
      <table class="result-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Conf</th>
            <th>Area (cm²)</th>
            <th>Volume (cm³)</th>
            <th>Severity</th>
            <th>Cost (₹)</th>
            <th>Time (min)</th>
          </tr>
        </thead>
        <tbody>
        {% for d in detections %}
          <tr>
            <td>{{ d.ID }}</td>
            <td>{{ d.Conf }}</td>
            <td>{{ d.Area_cm2 }}</td>
            <td>{{ d.Volume_cm3 }}</td>
            <td><span class="pill-severity {{ d.Severity }}">{{ d.Severity }}</span></td>
            <td>{{ d.Cost_Min }}–{{ d.Cost_Max }}</td>
            <td>{{ d.Time_min }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </section>
</main>

{% endblock %}
